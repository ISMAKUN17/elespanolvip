<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Menú de Bar</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&family=Open+Sans:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        html {
            scroll-behavior: smooth;
            font-size: 16px;
            background: #000;
        }
        body {
            margin: 0;
            padding: 0;
            font-family: 'Open Sans', sans-serif;
            background-color: #000;
            color: #FFF;
            line-height: 1.6;
        }
        header {
            background: url('https://images.unsplash.com/photo-1577717903275-c9676572e92c?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center center/cover;
            padding: 2rem 0 1rem 0;
            text-align: center;
            position: relative;
        }
        header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1;
        }
        .header-content {
            position: relative;
            z-index: 2;
        }
        .header-content img {
            max-width: 120px;
            margin-bottom: 1rem;
        }
        .header-content h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0;
            letter-spacing: 0.2rem;
        }
        .header-content p {
            font-size: 1.2rem;
            font-weight: 300;
            margin: 0.5rem 0 0 0;
        }
        main {
            max-width: 900px;
            margin: 2rem auto;
            background: rgba(0,0,0,0.85);
            border-radius: 1rem;
            box-shadow: 0 0 2.5rem rgba(0,0,0,0.9);
            padding: 2rem;
        }
        .exchange-form {
            margin-bottom:2rem;
            display:flex;
            align-items:center;
            gap:1rem;
        }
        .exchange-form label {
            font-weight:700;
        }
        .exchange-form input {
            width:100px;
            padding:0.5rem;
            border-radius:0.3rem;
            border:none;
            font-size:1rem;
        }
        .exchange-form button {
            background: #FFD700;
            color: #000;
            border: none;
            border-radius: 0.3rem;
            padding: 0.5rem 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
        }
        .exchange-form button:hover {
            background: #fff200;
        }
        .exchange-form span {
            color:#FFD700;
            display:none;
        }
        .admin-section {
            margin-bottom: 2.5rem;
        }
        .admin-section h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #FFD700;
        }
        .drink-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .drink-item {
            background: rgba(255,255,255,0.05);
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .drink-item h3 {
            margin: 0 0 0.3rem 0;
            font-size: 1.1rem;
            font-family: 'Montserrat', sans-serif;
        }
        .drink-item .description {
            font-size: 0.95rem;
            color: #CCC;
        }
        .drink-item .price {
            color: #FFD700;
            font-weight: 700;
            font-size: 1.1rem;
            margin-top: 0.3rem;
        }
        .drink-actions {
            margin-top: 0.5rem;
        }
        .drink-actions button {
            background: #FFD700;
            color: #000;
            border: none;
            border-radius: 0.3rem;
            padding: 0.3rem 0.8rem;
            margin-right: 0.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
        }
        .drink-actions button.delete {
            background: #c0392b;
            color: #fff;
        }
        .drink-actions button:hover {
            background: #fff200;
        }
        .drink-actions button.delete:hover {
            background: #e74c3c;
        }
        .add-form, .edit-form {
            background: rgba(255,255,255,0.08);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: flex-end;
        }
        .add-form input, .add-form select, .edit-form input, .edit-form select {
            padding: 0.5rem;
            border-radius: 0.3rem;
            border: none;
            font-size: 1rem;
            margin-right: 0.5rem;
        }
        .add-form button, .edit-form button {
            background: #FFD700;
            color: #000;
            border: none;
            border-radius: 0.3rem;
            padding: 0.5rem 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
        }
        .add-form button:hover, .edit-form button:hover {
            background: #fff200;
        }
        @media (max-width: 767px) {
            main {
                padding: 1rem;
            }
            .add-form, .edit-form {
                flex-direction: column;
                gap: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <img src="https://i.imgur.com/K9pl5TBl.png" alt="Logo de tu Bar">
            <h1>ADMIN MENÚ</h1>
            <p>EL ESPAÑOL VIP</p>
        </div>
    </header>
    <main>
        <!-- Campo para editar la tasa de cambio -->
        <form class="exchange-form" id="exchangeRateForm">
            <label for="exchangeRate">Tasa de cambio DOP→USD:</label>
            <input type="number" id="exchangeRate" min="1" step="0.01" required>
            <button type="submit">Guardar tasa</button>
            <span id="exchangeRateSaved">¡Guardado!</span>
        </form>
        <!-- Formulario para agregar bebidas -->
        <form class="add-form" id="addDrinkForm">
            <input type="text" id="drinkName" placeholder="Nombre de la bebida" required>
            <input type="text" id="drinkDescription" placeholder="Descripción" required>
            <input type="number" id="drinkPrice" placeholder="Precio" required min="0">
            <select id="drinkCategory" required>
                <option value="">Categoría</option>
                <option value="whiskey">Whiskey</option>
                <option value="vodka">Vodka</option>
                <option value="ron">Ron</option>
                <option value="cervezas">Cervezas</option>
                <option value="tequila">Tequila</option>
                <option value="vinos">Vinos</option>
                <option value="gin">Gin</option>
                <option value="cognac">Cognac</option>
                <option value="champan">Champán</option>
            </select>
            <button type="submit">Agregar bebida</button>
        </form>
        <div id="adminMenu"></div>
    </main>
    <script type="module">
        // Firebase config y setup
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getDatabase, ref, onValue, push, set, update, remove, get, child } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDUirwoSQgvcMZn7uLjKMAxlTA15Jkl2BM",
            authDomain: "ismakun-bf0fa.firebaseapp.com",
            databaseURL: "https://ismakun-bf0fa-default-rtdb.firebaseio.com",
            projectId: "ismakun-bf0fa",
            storageBucket: "ismakun-bf0fa.firebasestorage.app",
            messagingSenderId: "1028877703945",
            appId: "1:1028877703945:web:331de48acbcdf2234a51d8"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Categorías
        const CATEGORIES = [
            { id: "whiskey", name: "Whiskey" },
            { id: "vodka", name: "Vodka" },
            { id: "ron", name: "Ron" },
            { id: "cervezas", name: "Cervezas" },
            { id: "tequila", name: "Tequila" },
            { id: "vinos", name: "Vinos" },
            { id: "gin", name: "Gin" },
            { id: "cognac", name: "Cognac" },
            { id: "champan", name: "Champán" }
        ];

        // --- Tasa de cambio ---
        const exchangeRateInput = document.getElementById('exchangeRate');
        const exchangeRateSaved = document.getElementById('exchangeRateSaved');
        function loadExchangeRate() {
            get(child(ref(db), 'menu/exchangeRate')).then((snapshot) => {
                if (snapshot.exists()) {
                    exchangeRateInput.value = snapshot.val();
                } else {
                    exchangeRateInput.value = 58; // valor por defecto
                }
            });
        }
        loadExchangeRate();

        document.getElementById('exchangeRateForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const rate = parseFloat(exchangeRateInput.value);
            if (!rate || rate <= 0) return;
            set(ref(db, 'menu/exchangeRate'), rate).then(() => {
                exchangeRateSaved.style.display = 'inline';
                setTimeout(()=>{exchangeRateSaved.style.display='none';}, 1500);
            });
        });

        // Renderizar menú desde Firebase
        function renderMenu(menuData) {
            const adminMenu = document.getElementById('adminMenu');
            adminMenu.innerHTML = '';
            CATEGORIES.forEach(cat => {
                const drinks = menuData[cat.id] || {};
                if (Object.keys(drinks).length === 0) return; // No mostrar categorías vacías
                const section = document.createElement('section');
                section.className = 'admin-section';
                const h2 = document.createElement('h2');
                h2.textContent = cat.name;
                section.appendChild(h2);
                const list = document.createElement('div');
                list.className = 'drink-list';
                Object.entries(drinks).forEach(([drinkId, drink]) => {
                    const item = document.createElement('div');
                    item.className = 'drink-item';
                    item.innerHTML = `
                        <h3>${drink.name}</h3>
                        <div class="description">${drink.description}</div>
                        <div class="price">$${drink.price}</div>
                    `;
                    // Botones de acción
                    const actions = document.createElement('div');
                    actions.className = 'drink-actions';
                    const editBtn = document.createElement('button');
                    editBtn.textContent = 'Editar';
                    editBtn.onclick = () => showEditForm(cat.id, drinkId, drink);
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'Eliminar';
                    deleteBtn.className = 'delete';
                    deleteBtn.onclick = () => deleteDrink(cat.id, drinkId);
                    actions.appendChild(editBtn);
                    actions.appendChild(deleteBtn);
                    item.appendChild(actions);
                    list.appendChild(item);
                });
                section.appendChild(list);
                adminMenu.appendChild(section);
            });
        }

        // Leer menú en tiempo real
        function listenMenu() {
            const menuRef = ref(db, 'menu');
            onValue(menuRef, (snapshot) => {
                const data = snapshot.val() || {};
                renderMenu(data);
            });
        }
        listenMenu();

        // Agregar bebida
        document.getElementById('addDrinkForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('drinkName').value.trim();
            const description = document.getElementById('drinkDescription').value.trim();
            const price = document.getElementById('drinkPrice').value.trim();
            const category = document.getElementById('drinkCategory').value;
            if (!name || !description || !price || !category) return;
            const newDrinkRef = push(ref(db, `menu/${category}`));
            set(newDrinkRef, { name, description, price }).then(() => {
                this.reset();
            });
        });

        // Eliminar bebida
        function deleteDrink(category, drinkId) {
            if (confirm('¿Seguro que deseas eliminar esta bebida?')) {
                remove(ref(db, `menu/${category}/${drinkId}`));
            }
        }

        // Editar bebida
        function showEditForm(category, drinkId, drink) {
            // Eliminar cualquier otro formulario de edición
            document.querySelectorAll('.edit-form').forEach(f => f.remove());
            const item = event.target.closest('.drink-item');
            const form = document.createElement('form');
            form.className = 'edit-form';
            form.innerHTML = `
                <input type="text" name="name" value="${drink.name}" required>
                <input type="text" name="description" value="${drink.description}" required>
                <input type="number" name="price" value="${drink.price}" required min="0">
                <button type="submit">Guardar</button>
                <button type="button" class="cancel">Cancelar</button>
            `;
            form.onsubmit = function(e) {
                e.preventDefault();
                const newName = form.name.value.trim();
                const newDesc = form.description.value.trim();
                const newPrice = form.price.value.trim();
                if (!newName || !newDesc || !newPrice) return;
                update(ref(db, `menu/${category}/${drinkId}`), {
                    name: newName,
                    description: newDesc,
                    price: newPrice
                }).then(() => {
                    form.remove();
                });
            };
            form.querySelector('.cancel').onclick = function() {
                form.remove();
            };
            item.appendChild(form);
        }
    </script>
</body>
</html>